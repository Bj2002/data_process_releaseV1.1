from flask import Blueprint, session, abort, render_template, url_for, redirect
from flask_login import current_user
bp = Blueprint('register', __name__, url_prefix='/register')

@bp.route('/')
def register():
    if request.method == 'POST':
        username = request.form['username'].strip()
        password = request.form['password']
        if User.query.filter_by(username=username).first():
            flash('用户名已存在')
            return redirect(url_for('register'))
        user = User(username=username)
        user.set_password(password)
        db.session.add(user)
        db.session.commit()
        flash('注册成功，请登录')
        return redirect(url_for('login'))
    return render_template('register.html')
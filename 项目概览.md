项目概览  
========  
1 项目背景与目标  
----------------  
本系统为课题组对外数据处理服务平台，旨在：  
- 为管理员提供“服务卡片”可视化管理界面，可一键新增数据处理能力；  
- 为终端用户提供“上传 – 处理 – 下载结果”的极简流程；  
- 支持单文件/多文件输入及单结果/多结果输出的完整场景。  
- 提高课题组对外创收能力

2 技术栈  
---------  
- 后端框架：Python 3.x + Flask（WSGI）  
- 数据描述：CSV（function.csv）  
- 运行环境：  
  - Linux（Ubuntu 22.04 LTS）  
  - Windows Server 2019/2022  
- 部署方式：  
  - Linux：gunicorn + Nginx（反向代理）  
  - Windows：Waitress + IIS（反向代理）  

3 当前进度  
-----------  
| 阶段 | 里程碑 | 状态 |
|---|---|---|
| M0 | 基础框架 & 环境管理 | ✅ 已完成 |
| M1 | 单文件输入/单结果输出场景（MD5 校验值计算） | ✅ 已跑通 |
| M2 | 多文件输入/多结果输出场景（AES 加解密） | ✅ 已跑通 |
| M3 | 用户注册/登录/权限体系 | ✅ 已跑通 |
| M4 | admin通过表单插入新功能 | ✅ 已跑通 |
| M5 | 添加邀请码机制，凭一次性邀请码注册。由管理员预先将数份邀请码存在本地。(预期用户数量<1000) | 待实现 |



4 系统架构  
-----------  
```
┌────────────┐         ┌──────────────┐
│  浏览器    │ <-----> │  Flask App   │
└────────────┘         │   (app.py)   │
         ▲             └──────┬───────┘
         │                    │ 读取
         │              ┌─────┴─────┐
         │              │function.csv│
         │              └─────┬─────┘
         │                    │ 解析
         │              ┌─────┴─────────┐
         │              │  任务调度器    │
         │              └─────┬─────────┘
         │                    │ 调用
┌────────┴───────┐   ┌───────┴────────┐
│functions/{id}/ │   │functions/{id}/ │
│   env/python   │   │program/run.py  │
└────────────────┘   └────────────────┘
```

5 代码与配置规范  
----------------  
5.1 目录结构（推荐）  
```
project-root/
├── app.py                 # 主入口
├── requirements.txt       # 依赖
├── function.csv           # 服务卡片元数据
├── config.py              # 全局配置
├── admin_bp.py            # 管理员子系统蓝图
├── models/                # ORM 模型
├── functions/
│   ├── calc_md5/
│   │   ├── env/           # 虚拟环境
│   │   └── program/
│   │       └── run.py     # 业务脚本
│   └── AES_crypt/
│       ├── env/
│       └── program/
│           └── run.py     # 业务脚本
└── tests/                 # 单元测试
```

5.2 function.csv 字段规范  
| 字段名 | 类型 | 描述 | 示例 |  
|---|---|---|---|  
| ID | str | 唯一标识符，仅 `[a-z0-9_]` | `calc_md5` |  
| name | str | 用户可见名称 | `计算哈希值` |  
| input_list | list[str] | 输入文件扩展名列表 | `['txt']` |  
| output_list | list[str] | 输出文件扩展名列表 | `['txt']` |  
| description | str | 简要功能说明 | `计算文件哈希值` |  
| input_list_description | list[str] | 输入文件含义 | `['待计算哈希值的文件']` |  
| output_list_description | list[str] | 输出文件含义 | `['文件哈希报告']` |  

5.4 用户数据库schema

```python
class User(UserMixin, db.Model):
    id       = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(64), unique=True, nullable=False)
    password_hash = db.Column(db.String(128), nullable=False)
    role     = db.Column(db.String(64))
```

5.5 管理员子系统蓝图`admin_bp.py`

```python
@bp.route('/users')

def users():

  return '<h3>这里做“开/关新用户注册”页面</h3><a href="..">返回</a>'

@bp.route('/cards')

def cards():

  return '<h3>这里做“新增服务表单”页面</h3><a href="..">返回</a>'
```

5.5 运行时约定  

- 环境路径：`<project-root>/functions/{ID}/env/python(.exe)`  
- 程序入口：`<project-root>/functions/{ID}/program/run.py`  
- 接口签名（run.py）：  
```python
def main(input_files: list[str], output_dir: str) -> list[str]:
    """
    :param input_files: 已上传的绝对路径列表
    :param output_dir:  结果输出目录（已存在，可写）
    :return: 生成结果文件的绝对路径列表
    """
    ...
```

6 后续迭代计划  
---------------  
| 周期     | 日程                           | 优先度 |
|---|---|---|
| Sprint 3 | 管理员后台（通过新增服务卡片） | 已完成 |
| Sprint 4 | 添加简单的邀请码注册机制 | 高 |

7 风险与卡点  
-------------  
- **跨平台路径差异**：Windows 与 Linux 路径分隔符、可执行文件扩展名不同，需使用 `os.path`/`pathlib` 统一处理。  
- **资源隔离**：每个服务卡片使用独立虚拟环境，须防止依赖冲突及权限逃逸。  